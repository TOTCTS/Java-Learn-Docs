<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="720" viewBox="0 0 1200 720">
  <defs>
    <filter id="shadow-soft-tpe" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="2" stdDeviation="4" flood-color="#000" flood-opacity="0.12"/>
    </filter>
    <style>
      .h1 { font: 700 20px 'Inter', Arial, sans-serif; fill: #1f2a44; }
      .txt { font: 600 13px 'Inter', Arial, sans-serif; fill: #24324d; }
      .sub { font: 500 12px 'Inter', Arial, sans-serif; fill: #3a4a66; }
      .box { stroke: #8aa0b3; fill: #fff; rx: 12; filter: url(#shadow-soft-tpe); }
      .muted { stroke: #c5ced8; fill: #f7f9fc; rx: 12; }
      .warn { stroke: #ff9b73; fill: #fff5f0; rx: 12; filter: url(#shadow-soft-tpe); }
      .ok { stroke: #79c897; fill: #eefcf2; rx: 12; filter: url(#shadow-soft-tpe); }
      .arr { stroke: #5f6f86; stroke-width: 1.8; fill: none; marker-end: url(#tpeHead); }
      .dash { stroke-dasharray: 6 6; }
      .badge { fill: #2a6f97; stroke: none; }
      .badgeTxt { font: 700 12px 'Inter', Arial, sans-serif; fill: #fff; }
    </style>
    <marker id="tpeHead" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#5f6f86" />
    </marker>
  </defs>

  <text x="24" y="32" class="sub">v1.2 • 更新: 2025-08-08</text>
  <text x="24" y="58" class="h1">ThreadPoolExecutor 任务生命周期</text>

  <!-- 行1：提交 → 路由策略 → 执行/入队 -->
  <rect x="60" y="100" width="220" height="64" class="box"/>
  <rect x="60" y="100" width="28" height="28" class="badge" rx="14"/>
  <text x="69" y="119" class="badgeTxt">1</text>
  <text x="96" y="138" class="txt">submit(任务)</text>
  <path d="M 280 132 L 330 132" class="arr"/>

  <rect x="330" y="100" width="280" height="64" class="box"/>
  <rect x="330" y="100" width="28" height="28" class="badge" rx="14"/>
  <text x="339" y="119" class="badgeTxt">2</text>
  <text x="368" y="138" class="txt">队列策略：Synchronous / Array / Linked</text>
  <path d="M 610 132 L 660 132" class="arr"/>

  <rect x="660" y="100" width="220" height="64" class="ok"/>
  <rect x="660" y="100" width="28" height="28" class="badge" rx="14"/>
  <text x="669" y="119" class="badgeTxt">3</text>
  <text x="696" y="138" class="txt">创建/复用 Worker</text>
  <path d="M 880 132 L 980 132" class="arr"/>

  <rect x="980" y="100" width="160" height="64" class="ok"/>
  <rect x="980" y="100" width="28" height="28" class="badge" rx="14"/>
  <text x="989" y="119" class="badgeTxt">4</text>
  <text x="1016" y="138" class="txt">执行完成</text>

  <!-- 行2：入队路径与取出执行 -->
  <path d="M 470 164 L 470 210 L 520 210" class="arr"/>
  <rect x="520" y="182" width="220" height="64" class="box"/>
  <rect x="520" y="182" width="28" height="28" class="badge" rx="14"/>
  <text x="529" y="201" class="badgeTxt">2a</text>
  <text x="556" y="220" class="txt">入队等待</text>
  <path d="M 740 214 L 820 260" class="arr"/>

  <rect x="820" y="228" width="220" height="64" class="ok"/>
  <rect x="820" y="228" width="28" height="28" class="badge" rx="14"/>
  <text x="829" y="247" class="badgeTxt">3a</text>
  <text x="856" y="266" class="txt">Worker 取任务执行</text>

  <!-- 行3：队列满 → 拒绝策略 + 背压 -->
  <path d="M 610 164 L 610 308 L 590 308" class="arr dash"/>
  <rect x="420" y="276" width="300" height="64" class="warn"/>
  <rect x="420" y="276" width="28" height="28" class="badge" rx="14"/>
  <text x="429" y="295" class="badgeTxt">R</text>
  <text x="456" y="310" class="txt">
    <tspan x="456" dy="0">队列满 → 拒绝：</tspan>
    <tspan x="456" dy="18">Abort / Discard / DiscardOldest / CallerRuns</tspan>
  </text>

  <path d="M 420 308 L 340 308" class="arr dash"/>
  <rect x="180" y="276" width="160" height="64" class="muted"/>
  <text x="192" y="314" class="sub">CallerRuns：提交线程执行（背压）</text>

  <!-- 行4：取消/超时/回收/关闭 -->
  <rect x="60" y="380" width="360" height="64" class="box"/>
  <text x="72" y="404" class="sub">
    <tspan x="72" dy="0">取消/超时 → setRemoveOnCancelPolicy(true)</tspan>
    <tspan x="72" dy="18">清理队列</tspan>
  </text>

  <rect x="440" y="380" width="280" height="64" class="box"/>
  <text x="452" y="410" class="sub">空闲 ≥ keepAliveTime → 回收线程</text>

  <rect x="740" y="380" width="220" height="64" class="box"/>
  <text x="752" y="410" class="sub">shutdown：不接收新任务，处理完退出</text>

  <rect x="980" y="380" width="160" height="64" class="warn"/>
  <text x="992" y="404" class="sub">
    <tspan x="992" dy="0">shutdownNow：尝试中断</tspan>
    <tspan x="992" dy="18">并返回未执行任务</tspan>
  </text>

  <!-- 指标区 -->
  <rect x="60" y="470" width="1080" height="170" class="muted"/>
  <text x="72" y="496" class="txt">关键指标</text>
  <text x="72" y="522" class="sub">poolSize / core-max / largestPoolSize / activeCount / completedTaskCount</text>
  <text x="72" y="546" class="sub">queue.size / 拒绝次数 / 延迟 p95-p99 / 超时率</text>
  <text x="72" y="570" class="sub">GC 指标与堆压力 / 线程命名 / 异常上报</text>
</svg> 